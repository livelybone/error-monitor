/**
 * Bundle of error-monitor
 * Generated: 2019-04-08
 * Version: 1.1.0
 * License: MIT
 * Author: livelybone
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).ErrorMonitor=t()}(this,function(){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}(),r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e};function u(e){var t=e.message||e,n=new Error(t);return n.data=e,n}function i(t){if("object"!==(void 0===t?"undefined":o(t)))return t;if(t===window)return"window";if(t===document)return"document";if(t instanceof Element)return t.outerHTML.split(/\\?>/)[0]+">...";var n={},e=function(e){!t[e]||t[e]instanceof Function||(n[e]=i(t[e]))};return t instanceof Event?["srcElement","path","currentTarget","target","type","timeStamp","message","lineno","filename"].forEach(e):Object.getOwnPropertyNames(t).forEach(e),n}var t,n,s,a,l,f,p,d=(t=(window||{}).navigator,n=(t=void 0===t?{}:t).geolocation,s=void 0===n?null:n,a=void 0,function(t){var n=function(e){t(a=e)};void 0===a&&s?s.getCurrentPosition(function(e){return n(i(e))},function(e){n({error:"Get position failed: "+e.message})},{timeout:1e3}):n(a||null)}),y=(l=window,f=l.XMLHttpRequest,p=l.ActiveXObject,f||p?function(){return f?new f:new p("Microsoft.XMLHTTP")}:(alert("Your browser does not support XMLHTTP.\n      You may not be able to send messages to the server"),null));var v=function(){function t(e){c(this,t),this.baseUrl=e}return e(t,[{key:"send",value:function(e,t,n,o,r){var i=o.onResolve,s=o.onReject,a=y&&y();a&&(a.open(e,function(e,t){return/^http/.test(t)?t:e.replace(/\/*$/,"")+(t?t.replace(/^\/*/,"/"):"")}(this.baseUrl,t)),a.onreadystatechange=function(){var e=a.readyState,t=a.status,n=a.responseText,o=a.response;4===e&&200<=t&&(300<=t?s(u("Status: "+t)):i({data:n||o}))},a.onerror=function(){return s(u("Network Error!"))},a.ontimeout=function(){return s(u("Request timeout!"))},Object.keys(r).forEach(function(e){a.setRequestHeader(e,r[e])}),a.send(n))}},{key:"get",value:function(e,t,n){return this.send("GET",e,null,t,r({},n))}},{key:"post",value:function(e,t,n,o){return this.send("POST",e,"string"==typeof t?t:JSON.stringify(t),n,r({"content-type":"application/json"},o))}}]),t}();return function(){function u(e){var t=e.baseUrl,n=e.logsource,o=void 0===n?"http":n,r=e.dep,i=e.project,s=e.probability,a=void 0===s?1:s;if(c(this,u),!t)throw new Error("Param `baseUrl` is needed");if(!r)throw new Error("Param `dep` is needed");if(!i)throw new Error("Param `project` is needed");this.http=new v(t),this.probability=a,this.fields={logsource:o,dep:r,project:i,logtype:window.location.host},this.init()}return e(u,[{key:"init",value:function(){var n=this;window.addEventListener("error",function(e){var t=i(e);e.message?n.postMsg({type:"error-runtime",message:e.message,details:{error:t}}):n.postMsg({type:"error-resource",message:t.target,details:{error:t}})},!0)}},{key:"postMsg",value:function(e,t){var n=this,o=e.type,r=e.level,i=e.message,s=e.position,a=e.details,u=e.callbacks;if(Math.random()<=(t||this.probability)){var c=u||{},l=c.onSuccess,f=c.onFailed,p=function(e){n.http.post("",n.buildMsg({type:o,level:r,message:i,position:e,details:a}),{onResolve:function(e){console.log("ErrorMonitor: Error post successed"),"function"==typeof l&&l(e)},onReject:function(e){console.log("ErrorMonitor: Error post failed("+e.message+")"),"function"==typeof f&&f(e)}})};s?p(s):d(p)}}},{key:"buildMsg",value:function(e){var t=e.type,n=e.level,o=void 0===n?"error":n,r=e.message,i=e.position,s=e.details;return{fields:this.fields,type:t,level:o,url:window.location.pathname,message:r,position:i,userAgent:window.navigator.userAgent,details:s}}}]),u}()});
