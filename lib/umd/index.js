/**
 * Bundle of error-monitor
 * Generated: 2019-06-26
 * Version: 1.1.0
 * License: MIT
 * Author: livelybone
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).ErrorMonitor=t()}(this,function(){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e};function u(e){var t=e.message||e,n=new Error(t);return n.data=e,n}var t,n,r,c=(t=window,n=t.XMLHttpRequest,r=t.ActiveXObject,n||r?function(){return n?new n:new r("Microsoft.XMLHTTP")}:(alert("Your browser does not support XMLHTTP.\n      You may not be able to send messages to the server"),null));var f=function(){function t(e){l(this,t),this.baseUrl=e}return e(t,[{key:"send",value:function(e,t,n,r,o){var i=r.onResolve,a=r.onReject,s=c&&c();s&&(s.open(e,function(e,t){return/^https?:\/\//.test(t)?t:e.replace(/\/*$/,"")+(t?t.replace(/^\/*/,"/"):"")}(this.baseUrl,t)),s.onreadystatechange=function(){var e=s.readyState,t=s.status,n=s.responseText,r=s.response;4===e&&200<=t&&(300<=t?a(u("Status: "+t)):i({data:n||r}))},s.onerror=function(){return a(u("Network Error!"))},s.ontimeout=function(){return a(u("Request timeout!"))},Object.keys(o).forEach(function(e){s.setRequestHeader(e,o[e])}),s.send(n))}},{key:"get",value:function(e,t,n){return this.send("GET",e,null,t,s({},n))}},{key:"post",value:function(e,t,n,r){return this.send("POST",e,"string"==typeof t?t:JSON.stringify(t),n,s({"content-type":"application/json"},r))}}]),t}();return function(){function u(e){var t=e.baseUrl,n=e.project,r=e.platform,o=e.userAgent,i=e.batch,a=e.probability,s=void 0===a?1:a;if(l(this,u),!t)throw new Error("Param `baseUrl` is needed");if(!n)throw new Error("Param `project` is needed");if(!r)throw new Error("Param `platform` is needed");this.http=new f(t),this.probability=s,this.fields={project:n,hostname:window.location.host,platform:r,userAgent:o},this.batch=i,this.init()}return e(u,[{key:"init",value:function(){var r=this;window.addEventListener("error",function(e){var t=function t(n){if("object"!==(void 0===n?"undefined":o(n)))return n;if(n===window)return"window";if(n===document)return"document";if(n instanceof Element)return n.outerHTML.split(/\\?>/)[0]+">...";var r={},e=function(e){!n[e]||n[e]instanceof Function||(r[e]=t(n[e]))};return n instanceof Event?["srcElement","path","currentTarget","target","type","timeStamp","message","lineno","filename"].forEach(e):Object.getOwnPropertyNames(n).forEach(e),r}(e),n=void 0;n=e.message?{type:"error-runtime",level:"warn",message:e.message,details:{error:t}}:{type:"error-resource",level:"warn",message:t.target,details:{error:t}},r.batch?r.postLogBatch([n]):r.postLog(n)},!0)}},{key:"send",value:function(e,t){var n=t.url,r=void 0===n?"":n,o=t.callbacks,i=void 0===o?{}:o,a=t.probability;if(Math.random()<=(a||this.probability)){var s=i.onSuccess,u=i.onFailed;this.http.post(r,e,{onResolve:function(e){console.log("ErrorMonitor: Error post successed"),"function"==typeof s&&s(e)},onReject:function(e){console.log("ErrorMonitor: Error post failed("+e.message+")"),"function"==typeof u&&u(e)}})}}},{key:"postLog",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.url,r=t.callbacks,o=t.probability;this.send(this.buildLog(e),{url:n,callbacks:r,probability:o})}},{key:"postLogBatch",value:function(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=n.url,o=n.callbacks,i=n.probability;this.send(e.map(function(e){return t.buildLog(e)}),{url:r,callbacks:o,probability:i})}},{key:"buildLog",value:function(e){var t=e.type,n=e.level,r=void 0===n?"error":n,o=e.message,i=e.position,a=e.details;return s({},this.fields,{type:t,level:r,url:window.location.pathname,message:o,position:i,userAgent:this.fields.userAgent||window.navigator.userAgent,details:a})}}]),u}()});
